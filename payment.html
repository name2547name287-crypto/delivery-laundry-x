<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</title>
<link rel="stylesheet" href="css/payment.css">
</head>
<body>

<h2>üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

<div id="orderBox">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>

<script>
const orderId = new URLSearchParams(location.search).get("id");

async function loadPayment() {
  const orderSnap = await db.collection("orders").doc(orderId).get();
  const cfgSnap = await db.collection("config").doc("app").get();

  const o = orderSnap.data();
  const cfg = cfgSnap.data();

  document.getElementById("orderBox").innerHTML = `
    <div class="card">
      <h3>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h3>
      <div class="price">${o.price} ‡∏ö‡∏≤‡∏ó</div>

      <img src="${cfg.qrImageUrl}" class="qr">

      <div class="bank">
        <div>${cfg.bankName}</div>
        <div>${cfg.accountName}</div>
        <div>${cfg.bankAccount}</div>
        <div>PromptPay: ${cfg.promptpay}</div>
      </div>

      <div class="status">
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${o.paymentStatus === "unpaid" ? "‚è≥ ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô" }
                 : o.paymentStatus === "pending" ? "üîç ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"
                 : "‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß"}
      </div>


      <button onclick="markPaid()">‡∏â‡∏±‡∏ô‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
    </div>
  `;
}

async function markPaid() {
  await db.collection("orders").doc(orderId).update({
    paymentStatus: "paid"
  });
  alert("‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");
  location.href = "order.html";
}

loadPayment();
</script>

</body>
</html>
