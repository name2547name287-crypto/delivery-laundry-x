<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="css/app.css">
<link rel="icon" href="data:,">
<style>
.stat-box {
  background: #111;
  padding: 16px;
  border-radius: 14px;
  margin-bottom: 12px;
}
.order {
  background: #1c1c1c;
  padding: 12px;
  border-radius: 12px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h2>ğŸ“Š Admin Dashboard</h2>

<h3>ğŸ“¦ à¸­à¸­à¹€à¸”à¸­à¸£à¹Œà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™</h3>
<div id="currentOrders"></div>

<h3>ğŸ“ à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸­à¸­à¹€à¸”à¸­à¸£à¹Œ</h3>
<div id="historyOrders"></div>


<button onclick="saveSettings()">à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¹ˆà¸²</button>

<h3>ğŸ“ˆ à¸ªà¸–à¸´à¸•à¸´</h3 >

<div class="stat-box">
  <div>ğŸ“¦ à¸­à¸­à¹€à¸”à¸­à¸£à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: <span id="totalOrder">0</span></div>
  <div>ğŸ’° à¸£à¸²à¸¢à¹„à¸”à¹‰à¸£à¸§à¸¡: <span id="totalIncome">0</span> à¸šà¸²à¸—</div>
</div>

<div id="adminOrders">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>

<script>
auth.onAuthStateChanged(async user => {
  if (!user) return;

  // ğŸ” à¹€à¸Šà¹‡à¸ role
  const u = await db.collection("users").doc(user.uid).get();
  if (u.data().role !== "admin") {
    alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œ");
    location.href = "index.html";
    return;
  }

  const snap = await db.collection("orders").orderBy("createdAt","desc").get();
  let total = 0;
  document.getElementById("totalOrder").innerText = snap.size;

  const box = document.getElementById("adminOrders");
  box.innerHTML = "";

  snap.forEach(doc => {
    const o = doc.data();
    total += o.price;

    box.innerHTML += `
      <div class="order">
        ğŸ‘¤ ${o.username}<br>
        ğŸ§º ${o.weight} kg<br>
        ğŸ’° ${o.price} à¸šà¸²à¸—<br>
        â° ${o.timeSlot}
      </div>
    `;
  });

  document.getElementById("totalIncome").innerText = total;
});
</script>

<script>
auth.onAuthStateChanged(async user => {
  if (!user) return;

  const u = await db.collection("users").doc(user.uid).get();
  if (u.data().role !== "admin") {
    alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œ");
    location.href = "index.html";
    return;
  }

  const snap = await db.collection("orders")
    .orderBy("createdAt", "desc")
    .get();

  const cur = document.getElementById("currentOrders");
  const his = document.getElementById("historyOrders");

  cur.innerHTML = "";
  his.innerHTML = "";

  snap.forEach(doc => {
    const o = doc.data();
    const html = `
      <div style="border:1px solid #ccc;padding:8px;margin-bottom:6px">
        ğŸ§º ${o.weight} kg | ğŸ’° ${o.price} à¸šà¸²à¸— | ğŸ“Œ ${o.status}
      </div>
    `;

    if (o.status === "done") his.innerHTML += html;
    else cur.innerHTML += html;
  });
});
</script>


</body>
</html>
