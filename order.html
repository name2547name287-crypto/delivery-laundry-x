<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>р╕кр╕Цр╕▓р╕Щр╕░р╕нр╕нр╣Ар╕Фр╕нр╕гр╣М</title>
<link rel="stylesheet" href="css/order.css">
</head>
<body>

<h2>ЁЯУж р╕кр╕Цр╕▓р╕Щр╕░р╕нр╕нр╣Ар╕Фр╕нр╕гр╣Мр╕Вр╕нр╕Зр╕Йр╕▒р╕Щ</h2>
<div id="orderList">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф...</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="js/firebase.js"></script>
<script src="js/auth.js"></script>

<script>
function statusText(status) {
  if (status === "wait") return "ЁЯХТ р╕гр╕нр╕гр╕▒р╕Ър╕Ьр╣Йр╕▓";
  if (status === "pickup") return "ЁЯЪЪ р╕Бр╕│р╕ер╕▒р╕Зр╣Др╕Ыр╕гр╕▒р╕Ъ";
  if (status === "washing") return "ЁЯз╝ р╕Бр╕│р╕ер╕▒р╕Зр╕Лр╕▒р╕Б";
  if (status === "delivering") return "ЁЯУж р╕Бр╕│р╕ер╕▒р╕Зр╕кр╣Ир╕З";
  if (status === "done") return "тЬЕ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ";
  return status || "-";
}

auth.onAuthStateChanged(async user => {
  if (!user) {
    location.href = "login.html";
    return;
  }

  const snap = await db.collection("orders")
    .where("userId", "==", user.uid)
    .orderBy("createdAt", "desc")
    .get();

  const box = document.getElementById("orderList");
  box.innerHTML = "";

  if (snap.empty) {
    box.innerHTML = "тЭМ р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Ир╕нр╕З";
    return;
  }

  snap.forEach(doc => {
    const o = doc.data();
    box.innerHTML += `
  <div class="order-card">
    <div class="order-top">
      <span>ЁЯз║ ${o.weight} kg</span>
      <span class="price">ЁЯТ░ ${o.price} р╕Ър╕▓р╕Ч</span>
    </div>

    <div class="order-mid">
      тП░ ${o.bookingDate} ${o.timeSlot}
    </div>

    <div class="order-status">
      ${statusText(o.status)}
    </div>
  </div>
`;
  });
});

</script>

</body>
</html>
